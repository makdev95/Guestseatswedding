<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sarah & Devilliers Wedding Seating</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
</head>
<body>
    <div class="hero">
        <div class="overlay"></div>
        <div class="couple-image">
            <img src="sd.jpeg" alt="Sara & Devilliers">
        </div>
        <div class="container">
            <h1 class="title">Sarah <span class="heart">&hearts;</span> Devilliers</h1>
            <p class="subtitle typewriter">Celebrating Our Love</p>
            <div id="table-info" class="table-card"></div>
            <button class="admin-btn" id="admin-btn">Admin</button>
        </div>
        <div class="particles"></div>
    </div>

    <!-- Admin Modal -->
    <div id="admin-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAdminModal()">&times;</span>
            <div id="login-form">
                <h2>Admin Login</h2>
                <input type="email" id="email" placeholder="Email">
                <input type="password" id="password" placeholder="Password">
                <button onclick="adminLogin()">Login</button>
            </div>
            <div id="admin-content" style="display:none;">
                <h2>Manage Guests</h2>
                <textarea id="csv-input" placeholder="Paste CSV (Name,Table)"></textarea>
                <button onclick="loadCSV()">Load CSV</button>
                <button onclick="logout()">Logout</button>
                <h3>Guest List</h3>
                <ul id="guest-list"></ul>
            </div>
        </div>
    </div>


<script>

// Hardcoded admin credentials (change before deployment!)
const ADMIN_CREDENTIALS = {
    email: 'admin@wedding.com',
    password: 'sara_dev_2025'
};

// Generate unique ID by encoding name|table in base64
function generateId(name, table) {
    const combined = name + '|' + table;
    return btoa(combined);
}

// Guest View Logic: Decode the ID to get name and table directly
const urlParams = new URLSearchParams(window.location.search);
const guestId = urlParams.get('id');
if (guestId) {
    const tableInfo = document.getElementById('table-info');
    try {
        const decoded = atob(guestId);
        const [name, table] = decoded.split('|');
        if (name && table) {
            tableInfo.innerHTML = '<p>Hello, ' + name + '!</p><p>Vous êtes assis(e) à la : <strong>' + table + '</strong></p>';
        } else {
            tableInfo.innerHTML = 'Invité introuvable. Veuillez vérifier votre lien.';
        }
    } catch (e) {
        tableInfo.innerHTML = 'Invité introuvable. Veuillez vérifier votre lien.';
    }
} else {
    document.getElementById('table-info').innerHTML = 'Bienvenue ! Veuillez utiliser votre lien unique..';
}

// Admin Modal Logic
function openAdminModal() {
    document.getElementById('admin-modal').style.display = 'block';
}

function closeAdminModal() {
    document.getElementById('admin-modal').style.display = 'none';
}

function adminLogin() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    if (email === ADMIN_CREDENTIALS.email && password === ADMIN_CREDENTIALS.password) {
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('admin-content').style.display = 'block';
        loadGuests();
    } else {
        alert('Invalid credentials. Try again.');
    }
}

function logout() {
    document.getElementById('login-form').style.display = 'block';
    document.getElementById('admin-content').style.display = 'none';
    document.getElementById('email').value = '';
    document.getElementById('password').value = '';
}

function loadCSV() {
    const csv = document.getElementById('csv-input').value;
    const guests = [];
    const lines = csv.split('\n').map(function(line) { return line.trim(); }).filter(function(line) { return line; });
    if (lines[0].toLowerCase().includes('name,table')) lines.shift(); // Skip header
    lines.forEach(function(line) {
        const parts = line.split(',').map(function(item) { return item.trim(); });
        const name = parts[0];
        const table = parts[1];
        if (name && table) {
            guests.push({ name: name, table: table });
        }
    });
    localStorage.setItem('guests', JSON.stringify(guests));
    loadGuests();
}

function loadGuests() {
    const guestList = document.getElementById('guest-list');
    guestList.innerHTML = '';
    const guests = JSON.parse(localStorage.getItem('guests') || '[]');
    guests.forEach(function(guest) {
        const id = generateId(guest.name, guest.table);
        const li = document.createElement('li');
        li.innerHTML = guest.name + ' - ' + guest.table +
            '<button onclick="deleteGuest(\'' + id + '\')">Delete</button>' +
            '<div class="qr-code" id="qr-' + id + '"></div>';
        guestList.appendChild(li);
        new QRCode(document.getElementById('qr-' + id), {
            text: window.location.origin + '/?id=' + id,
            width: 100,
            height: 100
        });
    });
}

function deleteGuest(id) {
    if (confirm('Delete guest?')) {
        let guests = JSON.parse(localStorage.getItem('guests') || '[]');
        guests = guests.filter(function(g) { return generateId(g.name, g.table) !== id; });
        localStorage.setItem('guests', JSON.stringify(guests));
        loadGuests();
    }
}

// Attach event listener for Admin button
document.addEventListener('DOMContentLoaded', function() {
    const adminBtn = document.getElementById('admin-btn');
    if (adminBtn) {
        adminBtn.addEventListener('click', openAdminModal);
    }
});

// Expose functions for other onclick handlers
window.closeAdminModal = closeAdminModal;
window.adminLogin = adminLogin;
window.logout = logout;
window.loadCSV = loadCSV;
window.deleteGuest = deleteGuest;

</script>

</body>

</html>


